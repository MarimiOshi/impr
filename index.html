<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ãƒãƒ£ãƒƒãƒˆã‚µã‚¤ãƒˆ</title>
    <style>
        /* --- åŸºæœ¬ã‚¹ã‚¿ã‚¤ãƒ« (å‰å›ã‹ã‚‰å¾®èª¿æ•´) --- */
        :root {
            --app-overall-bg: #f0f2f5;
            --talk-list-bg: #ffffff;
            --current-chat-bg: #fdf6e9; /* ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯ãƒã‚³ã•ã‚“ãƒ†ãƒ¼ãƒã®èƒŒæ™¯ */
            --current-chat-accent: #E67E22; /* ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯ãƒã‚³ã•ã‚“ãƒ†ãƒ¼ãƒã®ã‚¢ã‚¯ã‚»ãƒ³ãƒˆ */
            --current-user-bubble-bg: #f0dcb3; /* ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯ãƒã‚³ã•ã‚“ãƒ†ãƒ¼ãƒã®ãƒ¦ãƒ¼ã‚¶ãƒ¼å¹ãå‡ºã— */
            --current-header-icon-color: var(--current-chat-accent); /* ãƒ˜ãƒƒãƒ€ãƒ¼ãƒ†ã‚­ã‚¹ãƒˆãƒœã‚¿ãƒ³ã«å½±éŸ¿ */
            --ai-bubble-bg: #ffffff;
            --ai-bubble-border: #e8e8e8;
            --header-text-color: #1c1e21; /* å°‘ã—æ¿ƒã„ã‚ã®é»’ */
            --text-color: #333333;
            --border-color: #e0e0e0; /* é€šå¸¸ã®å¢ƒç•Œç·š */
            --light-border-color: #f0f0f0; /* è–„ã„å¢ƒç•Œç·š */
            --inactive-text: #888888;
        }
        body { margin: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; background-color: var(--app-overall-bg); color: var(--text-color); display: flex; flex-direction: column; height: 100vh; overflow: hidden; }
        #app { display: flex; flex-direction: column; flex-grow: 1; height: 100%; }
        .screen { display: none; /* é€šå¸¸ã¯éè¡¨ç¤º */ flex-direction: column; height: 100%; /* è¦ª(#app)ã®é«˜ã•ä¸€æ¯ã«åºƒãŒã‚‹ */ }
        .screen.active { display: flex; /* ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªç”»é¢ã®ã¿è¡¨ç¤º */ }
        /* å„ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã®èƒŒæ™¯è‰²è¨­å®š */
        #talk-list-screen { background-color: var(--talk-list-bg); }
        #chat-screen { background-color: var(--current-chat-bg); } /* JSã§å‹•çš„æ›´æ–° */
        #member-settings-screen { background-color: var(--current-chat-bg); } /* JSã§å‹•çš„æ›´æ–° */
        #common-settings-screen, #profile-screen { background-color: var(--talk-list-bg); }


        header { padding: 8px 12px; /* å°‘ã—ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆã« */ border-bottom: 1px solid var(--border-color); display: flex; align-items: center; flex-shrink: 0; /* é«˜ã•ã‚’å›ºå®š */ min-height: 48px; box-sizing: border-box; position: relative; /* å­è¦ç´ ã®absoluteé…ç½®ã®ãŸã‚ */ }
        /* ãƒˆãƒ¼ã‚¯ä¸€è¦§ã®ãƒ˜ãƒƒãƒ€ãƒ¼ */
        #talk-list-screen header { background-color: #f7f7f7; /* ç”»åƒã«è¿‘ã„ç™½ã£ã½ã„èƒŒæ™¯ */ border-bottom: 1px solid #e7e7e7; }
        #talk-list-screen header h1 { text-align: left; font-size: 1.5em; /* ç”»åƒã®ã€Œãƒˆãƒ¼ã‚¯ã€ã®ã‚µã‚¤ã‚ºæ„Ÿ */ font-weight: bold; padding-left: 8px; color: var(--header-text-color); flex-grow:1; }
        /* ãƒãƒ£ãƒƒãƒˆç”»é¢ã¨ãƒ¡ãƒ³ãƒãƒ¼è¨­å®šç”»é¢ã®ãƒ˜ãƒƒãƒ€ãƒ¼ */
        #chat-screen header, #member-settings-screen header { background-color: var(--current-chat-bg); /* ãƒ†ãƒ¼ãƒã‚«ãƒ©ãƒ¼ã®èƒŒæ™¯ */ border-bottom-color: transparent; /* ç”»åƒã§ã¯å¢ƒç•Œç·šãŒè¦‹ãˆãªã„ */ min-height: 50px; }
        #chat-screen header h2, #member-settings-screen header h2 { /* ãƒ¡ãƒ³ãƒãƒ¼å */ font-size: 1.1em; font-weight: 600; color: var(--header-text-color); text-align: center; flex-grow: 1; /* ä¸­å¤®ã«é…ç½®ã™ã‚‹ãŸã‚ã«å¿…è¦ */ /* ãƒœã‚¿ãƒ³ã®å¹…ã‚’è€ƒæ…®ã—ã¦ä¸­å¤®å¯„ã› */ position: absolute; left: 60px; /* å·¦ãƒœã‚¿ãƒ³ã®ã‚¹ãƒšãƒ¼ã‚¹ */ right: 60px; /* å³ãƒœã‚¿ãƒ³ã®ã‚¹ãƒšãƒ¼ã‚¹ */ white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }


        header button { /* ãƒ˜ãƒƒãƒ€ãƒ¼å†…ã®å…±é€šãƒœã‚¿ãƒ³è¨­å®š */ background: none; border: none; cursor: pointer; padding: 0; display:flex; align-items:center; justify-content:center; min-width: 36px; min-height:36px; }
        header button img { height: 22px; width:auto; /* ã‚¢ã‚¤ã‚³ãƒ³ã‚µã‚¤ã‚ºèª¿æ•´ */}
        /* ãƒãƒ£ãƒƒãƒˆ/è¨­å®šç”»é¢ã®ãƒ˜ãƒƒãƒ€ãƒ¼ã‚¢ã‚¤ã‚³ãƒ³ã®è‰²ã‚’ãƒ†ãƒ¼ãƒã‚«ãƒ©ãƒ¼ã« */
        /* #chat-screen header button, #member-settings-screen header button { color: var(--current-header-icon-color); } ç”»åƒãªã®ã§ä¸è¦ */
        #chat-screen header .left-buttons, #member-settings-screen header .left-buttons { position: absolute; left: 10px; top:50%; transform: translateY(-50%); }
        #chat-screen header .right-buttons { position: absolute; right: 10px; top:50%; transform: translateY(-50%); display:flex; gap: 10px;}


        main { flex-grow: 1; /* å¯å¤‰é«˜ã•ã€æ®‹ã‚Šã®ã‚¹ãƒšãƒ¼ã‚¹ã‚’å…¨ã¦ä½¿ç”¨ */ overflow-y: auto; /* å†…å®¹ãŒå¤šã„å ´åˆã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ« */ -webkit-overflow-scrolling: touch; /* iOSã§ã®æ…£æ€§ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ« */ }
        #talk-list-screen main { padding: 0; } /* ãƒªã‚¹ãƒˆãªã®ã§mainè‡ªä½“ã®paddingã¯ä¸è¦ */
        #chat-screen main { padding: 10px 0 0 0; } /* ãƒãƒ£ãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚³ãƒ³ãƒ†ãƒŠç”¨ padding-bottomã¯ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚³ãƒ³ãƒ†ãƒŠã§ */
        #member-settings-screen main { padding: 15px; }


        /* ãƒ•ãƒƒã‚¿ãƒ¼ã®å…±é€šã‚¹ã‚¿ã‚¤ãƒ« */
        .screen > footer { border-top: 1px solid var(--border-color); padding: 0; /* å€‹åˆ¥ã«è¨­å®š */ display: flex; align-items: center; flex-shrink: 0; /* é«˜ã•ã‚’å›ºå®š */ background-color: #f7f7f7; /* åŸºæœ¬ãƒ•ãƒƒã‚¿ãƒ¼èƒŒæ™¯ */ }

        /* --- Talk List Screen (ç”»åƒ1æšç›®) --- */
        #member-list { list-style: none; padding: 0; margin: 0; }
        .member-item { display: flex; align-items: center; padding: 10px 15px; border-bottom: 1px solid var(--light-border-color); cursor: pointer; background-color: var(--talk-list-bg); /* ç™½èƒŒæ™¯ */ }
        .member-item:active { background-color: #f0f0f0; }
        .member-item:last-child { border-bottom: none; }

        .member-icon-container { width: 48px; height: 48px; border-radius: 50%; margin-right: 12px; border-width: 2.5px; /* ç”»åƒã«è¿‘ã„æ ç·šã®å¤ªã• */ border-style: solid; flex-shrink: 0; display:flex; align-items:center; justify-content:center; overflow:hidden; background-color: #eee; /* ç”»åƒèª­ã¿è¾¼ã¿ã¾ã§ã®ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼è‰² */ }
        .member-icon-container img {width:100%; height:100%; object-fit:cover;}
        .member-name { flex-grow: 1; font-size: 1.05em; font-weight: 500; color: #000; }
        .member-message-count { display: flex; align-items: center; font-size: 0.9em; color: var(--inactive-text); padding: 5px 8px; /* ã‚¯ãƒªãƒƒã‚¯ã—ã‚„ã™ã */ }
        .member-message-count img { width: 18px; height: 18px; margin-right: 5px; }


        #talk-list-screen footer { justify-content: space-around; height: 52px; /* ãƒ•ãƒƒã‚¿ãƒ¼ã®é«˜ã• */ box-sizing: border-box; border-top: 1px solid #dadada; }
        #talk-list-screen footer button { flex-direction: column; font-size: 0.65em; /* ç”»åƒã®æ–‡å­—ã®å°ã•ã• */ color: var(--inactive-text); padding: 4px 0; flex: 1; display: flex; justify-content: center; background:none; border:none; cursor:pointer;}
        /* #talk-list-screen footer button.active { color: var(--current-chat-accent); } JSã§ç”»åƒåˆ‡ã‚Šæ›¿ãˆãªã®ã§ç›´æ¥ã®è‰²æŒ‡å®šã¯ä¸è¦ */
        #talk-list-screen footer button img { width: 24px; height: 24px; margin-bottom: 2px; }
        #talk-list-screen footer button span {display:block;}


        /* --- Chat Screen (ç”»åƒ2æšç›®) --- */
        #chat-messages-container { /* ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤ºã‚¨ãƒªã‚¢ */ display: flex; flex-direction: column; padding: 0 0 10px 0; /* ä¸‹ã«å°‘ã—ä½™ç™½ã€ä»–ã¯mainã§åˆ¶å¾¡ */ }
        .message-bubble-wrapper { display: flex; margin-bottom: 10px; /* å¹ãå‡ºã—é–“ã®ä½™ç™½ */ padding: 0 10px; /* å·¦å³ã«å°‘ã—ä½™ç™½ */ width: calc(100% - 20px); /* paddingã‚’è€ƒæ…® */ box-sizing: border-box; }
        .message-bubble-wrapper.user { justify-content: flex-end; }
        .message-bubble-wrapper.ai { justify-content: flex-start; }

        .ai-icon-chat { width: 36px; height: 36px; border-radius: 50%; margin-right: 8px; border-width: 2px; border-style: solid; flex-shrink: 0; display:flex; align-items:center; justify-content:center; overflow:hidden; background-color: #eee; }
        .ai-icon-chat img {width:100%; height:100%; object-fit:cover;}
        .ai-message-content { display: flex; flex-direction: column; align-items: flex-start; }
        .ai-name-chat { font-size: 0.8em; color: #555; /* å°‘ã—æ¿ƒã„ã‚°ãƒ¬ãƒ¼ */ margin-bottom: 3px; padding-left: 2px; }

        .message-bubble { max-width: 78%; /* å¹ãå‡ºã—ã®æœ€å¤§å¹… */ padding: 10px 14px; border-radius: 18px; line-height: 1.45; word-wrap: break-word; box-shadow: 0 1px 1px rgba(0,0,0,0.08); /* å¹ãå‡ºã—ã«ã‚ãšã‹ãªå½± */ }
        .message-bubble.user { background-color: var(--current-user-bubble-bg); /* JSã§è¨­å®š */ color: var(--text-color); border-bottom-right-radius: 5px; /* ç”»åƒã®è§’ã®å½¢ */ }
        .message-bubble.ai { background-color: var(--ai-bubble-bg); border: 1px solid var(--ai-bubble-border); color: var(--text-color); border-bottom-left-radius: 5px; /* ç”»åƒã®è§’ã®å½¢ */ }

        #reply-suggestions-wrapper { /* è¿”ä¿¡å€™è£œã‚¨ãƒªã‚¢ã®ãƒ©ãƒƒãƒ‘ãƒ¼(èƒŒæ™¯è‰²ã¨paddingã®ãŸã‚) */ padding: 8px 10px; border-top: 1px solid var(--border-color); background-color: var(--current-chat-bg); /* ãƒ†ãƒ¼ãƒã‚«ãƒ©ãƒ¼ã®èƒŒæ™¯ */ flex-shrink: 0; /* é«˜ã•ã‚’å›ºå®š */ box-shadow: 0 -1px 2px rgba(0,0,0,0.03); /* ä¸Šã®å¢ƒç•Œã«å½± */ }
        #reply-suggestions { display: flex; flex-wrap: nowrap; /* æ¨ªä¸€åˆ— */ gap: 8px; overflow-x: auto; /* æ¨ªã‚¹ã‚¯ãƒ­ãƒ¼ãƒ« */ padding-bottom: 2px; /* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼ã®ã‚¹ãƒšãƒ¼ã‚¹ */ }
        .suggestion-btn { background-color: rgba(255,255,255,0.8); /* å°‘ã—é€éã—ãŸç™½ */ border: 1px solid #ccc; border-radius: 16px; padding: 7px 14px; font-size: 0.85em; cursor: pointer; white-space: nowrap; color: #333; box-shadow: 0 1px 1px rgba(0,0,0,0.05); }
        .suggestion-btn:active { background-color: rgba(255,255,255,1); }

        #chat-input-area { /* ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å…¥åŠ›ã‚¨ãƒªã‚¢ */ padding: 8px 10px; gap: 8px; /* å…¥åŠ›æ¬„ã¨ãƒœã‚¿ãƒ³ã®é–“éš” */ background-color: #f0f0f0; /* ç”»åƒã®å…¥åŠ›ã‚¨ãƒªã‚¢ã®èƒŒæ™¯è‰² */ border-top: 1px solid #ccc; }
        #message-input { flex-grow: 1; padding: 10px 15px; border-radius: 20px; border: 1px solid #d0d0d0; font-size: 1em; background-color: #fff; }
        #message-input:focus { outline: none; border-color: var(--current-chat-accent); }

        #send-message { /* é€ä¿¡ãƒœã‚¿ãƒ³ */ background-color: transparent; /* ç”»åƒã§è‰²ã‚’è¡¨ç¾ */ border: none; border-radius: 50%; width: 40px; height: 40px; display: flex; justify-content: center; align-items: center; cursor: pointer; padding:0; }
        #send-message img { width: 28px; height: 28px; /* é€ä¿¡ã‚¢ã‚¤ã‚³ãƒ³ã®ã‚µã‚¤ã‚ºèª¿æ•´ */ }
        #send-message:active img { transform: scale(0.95); }


        /* --- Member Settings Screen (ç”»åƒ3æšç›®) --- */
        .member-icon-large-container { display: flex; justify-content: center; margin-bottom: 25px; padding-top: 10px; }
        .member-icon-large { width: 90px; height: 90px; border-radius: 50%; border-width: 3.5px; /* ç”»åƒã«è¿‘ã„å¤ªã• */ border-style: solid; display:flex; align-items:center; justify-content:center; overflow:hidden; background-color: #eee; }
        .member-icon-large img {width:100%; height:100%; object-fit:cover;}
        #member-settings-screen h3 { /* ã€ŒåŸºæœ¬è¨­å®šã€ã€Œæ€§çš„è¨­å®šã€ã‚¿ã‚¤ãƒˆãƒ« */ font-size: 0.9em; color: var(--inactive-text); margin-top: 20px; margin-bottom: 8px; padding-bottom: 6px; border-bottom: 1px solid rgba(0,0,0,0.08); font-weight: 500; padding-left: 5px; }
        .setting-item { display: flex; justify-content: space-between; align-items: center; padding: 13px 5px; font-size: 0.95em; border-bottom: 1px solid rgba(0,0,0,0.05); /* ã‚ˆã‚Šè–„ã„åŒºåˆ‡ã‚Šç·š */ }
        .setting-item:last-child { border-bottom: none; }

        .setting-item .label { color: #444; }
        .setting-item .value, .setting-item .value.multi-value span { background-color: rgba(255,255,255,0.75); /* ã‚¿ã‚°ã®èƒŒæ™¯ */ border: 1px solid #dcdcdc; padding: 6px 12px; border-radius: 16px; /* ç”»åƒã®ã‚ˆã†ãªä¸¸ã¿ã®ã‚ã‚‹ã‚¿ã‚° */ font-size: 0.9em; cursor: pointer; min-width: 60px; text-align: center; color: #333; box-shadow: 0 1px 1px rgba(0,0,0,0.04); }
        .setting-item .value.multi-value { display: flex; gap: 6px; flex-wrap: wrap; justify-content: flex-end; max-width: 65%; /* å³å´ã®å€¤ã‚¨ãƒªã‚¢ã®æœ€å¤§å¹… */ }
         .setting-item .value.multi-value span { margin-bottom: 4px; } /* æŠ˜ã‚Šè¿”ã—æ™‚ã®é–“éš” */
         .setting-item .value:active { background-color: #fff; }


        /* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼ã®ã‚¹ã‚¿ã‚¤ãƒ«ï¼ˆç›®ç«‹ãŸãªã„ã‚ˆã†ã«ï¼‰ */
        main::-webkit-scrollbar, #reply-suggestions::-webkit-scrollbar { width: 5px; height: 5px; }
        main::-webkit-scrollbar-thumb, #reply-suggestions::-webkit-scrollbar-thumb { background-color: rgba(0,0,0,0.15); border-radius: 3px; }
        main::-webkit-scrollbar-track, #reply-suggestions::-webkit-scrollbar-track { background-color: transparent; }

    </style>
</head>
<body>
    <div id="app">
        <!-- Screen 1: Talk List -->
        <div id="talk-list-screen" class="screen active">
            <header><h1>ãƒˆãƒ¼ã‚¯</h1></header>
            <main>
                <ul id="member-list">
                    <!-- Member items will be dynamically generated by JS -->
                </ul>
            </main>
            <footer>
                <button id="nav-common-settings"><img src="image/icon/nav_settings_off.png" alt="å…±é€šè¨­å®š"><span>å…±é€šè¨­å®š</span></button>
                <button id="nav-talk" class="active"><img src="image/icon/nav_talk_on.png" alt="ãƒˆãƒ¼ã‚¯"><span>ãƒˆãƒ¼ã‚¯</span></button>
                <button id="nav-profile"><img src="image/icon/nav_profile_off.png" alt="ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«"><span>ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«</span></button>
            </footer>
        </div>

        <!-- Screen 2: Chat Screen -->
        <div id="chat-screen" class="screen">
            <header>
                <div class="left-buttons"><button id="chat-back-to-list" title="æˆ»ã‚‹"><img src="image/icon/header_back.png" alt="æˆ»ã‚‹"></button></div>
                <h2 id="chat-member-name">ãƒ¡ãƒ³ãƒãƒ¼å</h2>
                <div class="right-buttons">
                    <button id="chat-new-talk" title="æ–°ã—ã„ãƒˆãƒ¼ã‚¯ã‚’ä½œæˆ"><img src="image/icon/header_new_chat.png" alt="æ–°ã—ã„ãƒˆãƒ¼ã‚¯"></button>
                    <button id="chat-menu" title="ãƒ¡ãƒ³ãƒãƒ¼è¨­å®š"><img src="image/icon/header_menu.png" alt="ãƒ¡ãƒ³ãƒãƒ¼è¨­å®š"></button>
                </div>
            </header>
            <main id="chat-main-scroll-area"> <!-- ã“ã®mainãŒã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã™ã‚‹ -->
                <div id="chat-messages-container">
                     <!-- Chat messages will be here -->
                </div>
            </main>
            <div id="reply-suggestions-wrapper"> <!-- èƒŒæ™¯ã¨paddingã®ãŸã‚ -->
                <div id="reply-suggestions">
                    <button class="suggestion-btn">æ°—æŒã¡ã„ã„ï¼Ÿ</button>
                    <button class="suggestion-btn">ãƒãƒ³ãƒãƒ³ãƒãƒ³ãƒãƒ³</button>
                    <button class="suggestion-btn">ãƒ“ãƒ¥ãƒ«ãƒ«ãƒ«ãƒ«</button>
                    <button class="suggestion-btn">ã‚‚ã£ã¨ã¡ã‚‡ã†ã ã„</button>
                    <button class="suggestion-btn">å¤§å¥½ãã ã‚ˆ</button>
                </div>
            </div>
            <footer id="chat-input-area">
                <input type="text" id="message-input" placeholder="ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…¥åŠ›...">
                <button id="send-message" title="é€ä¿¡"><img src="image/icon/button_send_mako.png" alt="é€ä¿¡"></button>
            </footer>
        </div>

        <!-- Screen 3: Member Settings Screen -->
        <div id="member-settings-screen" class="screen">
            <header>
                <div class="left-buttons"><button id="settings-back-to-chat" title="æˆ»ã‚‹"><img src="image/icon/header_back.png" alt="æˆ»ã‚‹"></button></div>
                <h2 id="settings-member-name">ãƒ¡ãƒ³ãƒãƒ¼å è¨­å®š</h2>
                <div class="right-buttons"></div> <!-- è¨­å®šç”»é¢ã§ã¯å³ãƒœã‚¿ãƒ³ãªã— -->
            </header>
            <main>
                <div class="member-icon-large-container">
                    <div class="member-icon-large" id="settings-member-icon-wrapper"><img src="" alt="" id="settings-member-icon"></div>
                </div>
                <h3>åŸºæœ¬è¨­å®š</h3>
                <div id="basic-settings-container">
                    <!-- Basic settings will be dynamically generated -->
                </div>
                <h3>æ€§çš„è¨­å®š</h3>
                <div id="sexual-settings-container">
                    <!-- Sexual settings will be dynamically generated -->
                </div>
            </main>
        </div>

        <!-- Screen 4: Common Settings (Placeholder) -->
        <div id="common-settings-screen" class="screen">
            <header><button class="back-to-talk-list" title="æˆ»ã‚‹"><img src="image/icon/header_back.png" alt="æˆ»ã‚‹"></button><h1>å…±é€šè¨­å®š</h1></header>
            <main><p style="padding:15px;">å…±é€šè¨­å®šç”»é¢ (æœªå®Ÿè£…)</p></main>
        </div>

        <!-- Screen 5: Profile Screen (Placeholder) -->
        <div id="profile-screen" class="screen">
            <header><button class="back-to-talk-list" title="æˆ»ã‚‹"><img src="image/icon/header_back.png" alt="æˆ»ã‚‹"></button><h1>ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«</h1></header>
            <main><p style="padding:15px;">ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”»é¢ (æœªå®Ÿè£…)</p></main>
        </div>
    </div>

    <script>
        const ICON_PATH = 'image/icon/'; // ã‚¢ã‚¤ã‚³ãƒ³ãƒ•ã‚©ãƒ«ãƒ€ã®ãƒ‘ã‚¹

        // --- Theme Data ---
        const membersThemeData = {
            'mako':  { name: 'ãƒã‚³', accentColor: '#E67E22', bgColor: '#fdf6e9', userBubbleBg: '#f0dcb3' },
            'rio':   { name: 'ãƒªã‚ª', accentColor: '#3498DB', bgColor: '#eaf3f9', userBubbleBg: '#cce0f1' },
            'maya':  { name: 'ãƒãƒ¤', accentColor: '#8E44AD', bgColor: '#f4eef7', userBubbleBg: '#e2d2ea' },
            'riku':  { name: 'ãƒªã‚¯', accentColor: '#F1C40F', bgColor: '#fef9e7', userBubbleBg: '#fbeea9' },
            'ayaka': { name: 'ã‚¢ãƒ¤ã‚«', accentColor: '#AAB8C2', bgColor: '#f5f7f8', userBubbleBg: '#dde3e6' },
            'mayuka':{ name: 'ãƒãƒ¦ã‚«', accentColor: '#1ABC9C', bgColor: '#e8f8f5', userBubbleBg: '#c5e9e0' },
            'rima':  { name: 'ãƒªãƒ', accentColor: '#E74C3C', bgColor: '#fdedeb', userBubbleBg: '#f6cec8' },
            'miihi': { name: 'ãƒŸã‚¤ãƒ’', accentColor: '#FF69B4', bgColor: '#fff0f7', userBubbleBg: '#ffd9ec' },
            'nina':  { name: 'ãƒ‹ãƒŠ', accentColor: '#34495E', bgColor: '#ebedef', userBubbleBg: '#ccd1d6' }
        };

        // --- Member Data (settings ã®è©³ç´°ã¯ã‚µãƒ³ãƒ—ãƒ«) ---
        let membersData = {
            'mako': { id: 'mako', name: 'ãƒã‚³', msgCount: 9, theme: membersThemeData['mako'], faceIconFile: 'mako_face.png', sendButtonIconFile: 'button_send_mako.png', settings: { 'ç”Ÿå¹´æœˆæ—¥': '2001å¹´4æœˆ4æ—¥', 'ãƒ¡ãƒ³ãƒãƒ¼ã‚«ãƒ©ãƒ¼': 'ã‚ªãƒ¬ãƒ³ã‚¸', 'å‡ºèº«': 'ç¦å²¡', 'æ–¹è¨€': 'è»½ã„åšå¤šå¼', 'æ€§æ ¼': ['å¤©ç„¶', 'ã—ã£ã‹ã‚Šè€…'], 'èº«é•·': '159cm', 'ä½“é‡': '49kg', 'èƒ¸ã®ã‚µã‚¤ã‚º': 'Cã‚«ãƒƒãƒ—', 'ä¹³é¦–ã®è‰²': 'è–„ã„èŒ¶è‰²', 'é™°æ¯›': 'å°‘ã—ç”Ÿãˆã¦ã„ã‚‹', 'ã¾ã‚“ã“ã®è‰²': 'ãƒ”ãƒ³ã‚¯', 'æ€§æ¬²': 'æ™®é€š', 'å¥½ããªä½“ä½': 'æ­£å¸¸ä½', 'æ„Ÿåº¦': 'ã™ãã‚¤ãƒƒã¡ã‚ƒã†', 'å¾—æ„ãªå‰æˆ¯': 'ãƒ•ã‚§ãƒ©' } },
            'rio':  { id: 'rio',  name: 'ãƒªã‚ª', msgCount: 10, theme: membersThemeData['rio'], faceIconFile: 'rio_face.png', sendButtonIconFile: 'button_send_rio.png', settings: { 'ç”Ÿå¹´æœˆæ—¥': '2002å¹´2æœˆ4æ—¥', 'ãƒ¡ãƒ³ãƒãƒ¼ã‚«ãƒ©ãƒ¼': 'ãƒ–ãƒ«ãƒ¼', 'å‡ºèº«': 'æ„›çŸ¥','æ€§æ ¼': ['åŠªåŠ›å®¶'], 'èƒ¸ã®ã‚µã‚¤ã‚º': 'Bã‚«ãƒƒãƒ—'  /* ä»–ã¯çœç•¥ */ } },
            'maya': { id: 'maya', name: 'ãƒãƒ¤', msgCount: 7, theme: membersThemeData['maya'], faceIconFile: 'maya_face.png', sendButtonIconFile: 'button_send_maya.png', settings: { 'ç”Ÿå¹´æœˆæ—¥': '2002å¹´4æœˆ8æ—¥', 'ãƒ¡ãƒ³ãƒãƒ¼ã‚«ãƒ©ãƒ¼': 'ãƒ‘ãƒ¼ãƒ—ãƒ«','å‡ºèº«': 'çŸ³å·', 'æ€§æ ¼': ['ãŠã£ã¨ã‚Š'], 'èƒ¸ã®ã‚µã‚¤ã‚º': 'Dã‚«ãƒƒãƒ—' /* ä»–ã¯çœç•¥ */ } },
            'riku': { id: 'riku', name: 'ãƒªã‚¯', msgCount: 0, theme: membersThemeData['riku'], faceIconFile: 'riku_face.png', sendButtonIconFile: 'button_send_riku.png', settings: { 'ç”Ÿå¹´æœˆæ—¥': '2002å¹´10æœˆ26æ—¥', 'ãƒ¡ãƒ³ãƒãƒ¼ã‚«ãƒ©ãƒ¼': 'ã‚¤ã‚¨ãƒ­ãƒ¼','å‡ºèº«': 'äº¬éƒ½',  'æ€§æ ¼': ['å…ƒæ°—'], 'èƒ¸ã®ã‚µã‚¤ã‚º': 'Aã‚«ãƒƒãƒ—' /* ä»–ã¯çœç•¥ */ } },
            'ayaka':{ id: 'ayaka',name: 'ã‚¢ãƒ¤ã‚«', msgCount: 1, theme: membersThemeData['ayaka'],faceIconFile: 'ayaka_face.png',sendButtonIconFile: 'button_send_ayaka.png',settings: { 'ç”Ÿå¹´æœˆæ—¥': '2003å¹´6æœˆ20æ—¥', 'ãƒ¡ãƒ³ãƒãƒ¼ã‚«ãƒ©ãƒ¼': 'ãƒ›ãƒ¯ã‚¤ãƒˆ','å‡ºèº«': 'æ±äº¬', 'æ€§æ ¼': ['ãƒã‚¤ãƒšãƒ¼ã‚¹'], 'èƒ¸ã®ã‚µã‚¤ã‚º': 'Cã‚«ãƒƒãƒ—' /* ä»–ã¯çœç•¥ */ } },
            'mayuka':{id: 'mayuka',name: 'ãƒãƒ¦ã‚«',msgCount: 12,theme: membersThemeData['mayuka'],faceIconFile: 'mayuka_face.png',sendButtonIconFile: 'button_send_mayuka.png',settings: { 'ç”Ÿå¹´æœˆæ—¥': '2003å¹´11æœˆ13æ—¥', 'ãƒ¡ãƒ³ãƒãƒ¼ã‚«ãƒ©ãƒ¼': 'ãƒ©ã‚¤ãƒˆã‚°ãƒªãƒ¼ãƒ³','å‡ºèº«': 'äº¬éƒ½', 'æ€§æ ¼': ['ã‚«ãƒ¡ãƒ¬ã‚ªãƒ³'], 'èƒ¸ã®ã‚µã‚¤ã‚º': 'Bã‚«ãƒƒãƒ—' /* ä»–ã¯çœç•¥ */ } },
            'rima': { id: 'rima', name: 'ãƒªãƒ', msgCount: 15, theme: membersThemeData['rima'], faceIconFile: 'rima_face.png', sendButtonIconFile: 'button_send_rima.png', settings: { 'ç”Ÿå¹´æœˆæ—¥': '2004å¹´3æœˆ26æ—¥', 'ãƒ¡ãƒ³ãƒãƒ¼ã‚«ãƒ©ãƒ¼': 'ãƒ¬ãƒƒãƒ‰','å‡ºèº«': 'æ±äº¬', 'æ€§æ ¼': ['ãŠã—ã‚ƒã‚Œ'], 'èƒ¸ã®ã‚µã‚¤ã‚º': 'Cã‚«ãƒƒãƒ—' /* ä»–ã¯çœç•¥ */ } },
            'miihi':{ id: 'miihi',name: 'ãƒŸã‚¤ãƒ’',msgCount: 17,theme: membersThemeData['miihi'],faceIconFile: 'miihi_face.png',sendButtonIconFile: 'button_send_miihi.png',settings: { 'ç”Ÿå¹´æœˆæ—¥': '2004å¹´8æœˆ12æ—¥', 'ãƒ¡ãƒ³ãƒãƒ¼ã‚«ãƒ©ãƒ¼': 'ãƒ”ãƒ³ã‚¯','å‡ºèº«': 'äº¬éƒ½', 'æ€§æ ¼': ['ç™’ã—'], 'èƒ¸ã®ã‚µã‚¤ã‚º': 'Aã‚«ãƒƒãƒ—' /* ä»–ã¯çœç•¥ */ } },
            'nina': { id: 'nina', name: 'ãƒ‹ãƒŠ', msgCount: 2, theme: membersThemeData['nina'], faceIconFile: 'nina_face.png', sendButtonIconFile: 'button_send_nina.png', settings: { 'ç”Ÿå¹´æœˆæ—¥': '2005å¹´2æœˆ27æ—¥', 'ãƒ¡ãƒ³ãƒãƒ¼ã‚«ãƒ©ãƒ¼': 'ãƒã‚¤ãƒ“ãƒ¼','å‡ºèº«': 'ãƒ¯ã‚·ãƒ³ãƒˆãƒ³å·', 'æ€§æ ¼': ['æœ«ã£å­'], 'èƒ¸ã®ã‚µã‚¤ã‚º': 'Dã‚«ãƒƒãƒ—' /* ä»–ã¯çœç•¥ */ } },
        };
        // å…¨ãƒ¡ãƒ³ãƒãƒ¼ã«ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šã‚’é©ç”¨ï¼ˆä¸è¶³åˆ†ã‚’è£œã†ï¼‰
        Object.values(membersData).forEach(member => {
            const defaultSettings = { 'ç”Ÿå¹´æœˆæ—¥': '', 'ãƒ¡ãƒ³ãƒãƒ¼ã‚«ãƒ©ãƒ¼': '', 'å‡ºèº«': '', 'æ–¹è¨€': '', 'æ€§æ ¼': [], 'èº«é•·': '', 'ä½“é‡': '', 'èƒ¸ã®ã‚µã‚¤ã‚º': '', 'ä¹³é¦–ã®è‰²': '', 'é™°æ¯›': '', 'ã¾ã‚“ã“ã®è‰²': '', 'æ€§æ¬²': '', 'å¥½ããªä½“ä½': '', 'æ„Ÿåº¦': '', 'å¾—æ„ãªå‰æˆ¯': '' };
            member.settings = { ...defaultSettings, ...member.settings };
            if (!member.faceIconFile) member.faceIconFile = 'default_face.png'; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆé¡”ã‚¢ã‚¤ã‚³ãƒ³
        });


        let currentMemberId = null;
        let chatHistory = {}; // { memberId: [{ type: 'ai'/'user', text: '...', senderName: 'ãƒã‚³' }] }

        // --- DOM Elements ---
        const screens = document.querySelectorAll('.screen');
        const memberListUl = document.getElementById('member-list');
        const navButtons = { // ãƒ•ãƒƒã‚¿ãƒ¼ãƒŠãƒ“ãƒœã‚¿ãƒ³ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
            settings: document.getElementById('nav-common-settings'),
            talk: document.getElementById('nav-talk'),
            profile: document.getElementById('nav-profile')
        };

        const chatScreen = document.getElementById('chat-screen');
        const chatMainScrollArea = document.getElementById('chat-main-scroll-area');
        const chatBackToListBtn = document.getElementById('chat-back-to-list');
        const chatMemberNameH2 = document.getElementById('chat-member-name');
        const chatNewTalkBtn = document.getElementById('chat-new-talk');
        const chatMenuBtn = document.getElementById('chat-menu');
        const chatMessagesContainer = document.getElementById('chat-messages-container');
        const replySuggestionsDiv = document.getElementById('reply-suggestions');
        const messageInput = document.getElementById('message-input');
        const sendMessageBtn = document.getElementById('send-message');
        const sendMessageImg = sendMessageBtn.querySelector('img'); // é€ä¿¡ãƒœã‚¿ãƒ³å†…ã®imgè¦ç´ 

        const memberSettingsScreen = document.getElementById('member-settings-screen');
        const settingsBackToChatBtn = document.getElementById('settings-back-to-chat');
        const settingsMemberNameH2 = document.getElementById('settings-member-name');
        const settingsMemberIcon = document.getElementById('settings-member-icon'); // è¨­å®šç”»é¢ã®ãƒ¡ãƒ³ãƒãƒ¼ã‚¢ã‚¤ã‚³ãƒ³img
        const settingsMemberIconWrapper = document.getElementById('settings-member-icon-wrapper'); // è¨­å®šç”»é¢ã®ãƒ¡ãƒ³ãƒãƒ¼ã‚¢ã‚¤ã‚³ãƒ³ã®ãƒ©ãƒƒãƒ‘ãƒ¼div
        const basicSettingsContainer = document.getElementById('basic-settings-container');
        const sexualSettingsContainer = document.getElementById('sexual-settings-container');

        const commonSettingsScreen = document.getElementById('common-settings-screen');
        const profileScreen = document.getElementById('profile-screen');
        const backToTalkListBtns = document.querySelectorAll('.back-to-talk-list');
        const rootStyle = document.documentElement.style;

        // --- Theme Application ---
        function applyTheme(memberId) {
            const member = membersData[memberId];
            if (member && member.theme) {
                rootStyle.setProperty('--current-chat-bg', member.theme.bgColor);
                rootStyle.setProperty('--current-chat-accent', member.theme.accentColor);
                rootStyle.setProperty('--current-user-bubble-bg', member.theme.userBubbleBg);
                rootStyle.setProperty('--current-header-icon-color', member.theme.accentColor); // ç”»åƒã§ãªã„ãƒ˜ãƒƒãƒ€ãƒ¼ãƒœã‚¿ãƒ³ç”¨
                if (sendMessageImg && member.sendButtonIconFile) {
                    sendMessageImg.src = ICON_PATH + member.sendButtonIconFile;
                    sendMessageImg.alt = `${member.name}ã¸é€ä¿¡`;
                }
            }
        }
        function resetThemeToDefault() { // ãƒˆãƒ¼ã‚¯ä¸€è¦§ãªã©ã«æˆ»ã‚‹æ™‚ç”¨
            rootStyle.setProperty('--current-chat-bg', membersThemeData['mako'].bgColor); // ãƒã‚³ã•ã‚“ãƒ†ãƒ¼ãƒã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã«
            rootStyle.setProperty('--current-chat-accent', membersThemeData['mako'].accentColor);
            rootStyle.setProperty('--current-user-bubble-bg', membersThemeData['mako'].userBubbleBg);
            rootStyle.setProperty('--current-header-icon-color', '#333'); // TalkListãªã©ã®ãƒ˜ãƒƒãƒ€ãƒ¼ã‚¢ã‚¤ã‚³ãƒ³ã¯é»’ç³»
            // é€ä¿¡ãƒœã‚¿ãƒ³ã‚‚ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ¡ãƒ³ãƒãƒ¼ï¼ˆãƒã‚³ï¼‰ã®ã‚‚ã®ã«
            if (sendMessageImg && membersData['mako']?.sendButtonIconFile) {
                 sendMessageImg.src = ICON_PATH + membersData['mako'].sendButtonIconFile;
                 sendMessageImg.alt = `é€ä¿¡`;
            }
        }

        // ãƒ•ãƒƒã‚¿ãƒ¼ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚¢ã‚¤ã‚³ãƒ³æ›´æ–°
        function updateFooterNavIcons(activeScreenId) {
            Object.keys(navButtons).forEach(key => {
                const btn = navButtons[key];
                const img = btn.querySelector('img');
                let baseName = ''; // nav_settings, nav_talk, nav_profile
                if (key === 'settings') baseName = 'nav_settings';
                else if (key === 'talk') baseName = 'nav_talk';
                else if (key === 'profile') baseName = 'nav_profile';

                if ((key === 'talk' && activeScreenId === 'talk-list-screen') ||
                    (key === 'settings' && activeScreenId === 'common-settings-screen') ||
                    (key === 'profile' && activeScreenId === 'profile-screen')) {
                    img.src = ICON_PATH + baseName + '_on.png';
                    btn.classList.add('active'); // ã‚¹ã‚¿ã‚¤ãƒ«ç”¨ã«ã‚¯ãƒ©ã‚¹ã‚‚ã¤ã‘ã‚‹
                } else {
                    img.src = ICON_PATH + baseName + '_off.png';
                    btn.classList.remove('active');
                }
            });
        }

        // --- Navigation ---
        function showScreen(screenId) {
            screens.forEach(screen => screen.classList.remove('active'));
            document.getElementById(screenId).classList.add('active');
            updateFooterNavIcons(screenId); // ãƒ•ãƒƒã‚¿ãƒ¼ã‚¢ã‚¤ã‚³ãƒ³ã‚’æ›´æ–°

            if (screenId === 'chat-screen' || screenId === 'member-settings-screen') {
                if (currentMemberId) applyTheme(currentMemberId);
            } else {
                resetThemeToDefault(); // ä»–ã®ç”»é¢ã§ã¯ãƒ†ãƒ¼ãƒã‚’ãƒªã‚»ãƒƒãƒˆ
            }
        }

        // --- Rendering ---
        function renderMemberList() {
            memberListUl.innerHTML = '';
            Object.values(membersData).forEach(member => {
                const li = document.createElement('li');
                li.className = 'member-item';
                li.dataset.memberId = member.id;

                const iconContainer = document.createElement('div');
                iconContainer.className = 'member-icon-container';
                iconContainer.style.borderColor = member.theme.accentColor;
                const iconImg = document.createElement('img');
                iconImg.src = ICON_PATH + (member.faceIconFile || 'default_face.png'); // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆç”»åƒã‚‚è€ƒæ…®
                iconImg.alt = member.name;
                iconContainer.appendChild(iconImg);

                const nameSpan = document.createElement('span');
                nameSpan.className = 'member-name';
                nameSpan.textContent = member.name;

                const countDiv = document.createElement('div');
                countDiv.className = 'member-message-count';
                const countIcon = document.createElement('img'); // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ•°ã‚¢ã‚¤ã‚³ãƒ³ã‚‚ç”»åƒã«
                countIcon.src = ICON_PATH + 'icon_message_bubble.png';
                countIcon.alt = 'ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸';
                countDiv.appendChild(countIcon);
                countDiv.append(` ${member.msgCount}`); // ãƒ†ã‚­ã‚¹ãƒˆãƒãƒ¼ãƒ‰ã¨ã—ã¦è¿½åŠ 


                // Click on member name/icon area
                const mainClickArea = document.createElement('div');
                mainClickArea.style.cssText = 'display:flex; align-items:center; flex-grow:1; cursor:pointer;';
                mainClickArea.appendChild(iconContainer);
                mainClickArea.appendChild(nameSpan);
                mainClickArea.addEventListener('click', () => openChat(member.id, true)); // true for new talk

                // Click on message count area
                countDiv.style.cursor = 'pointer';
                countDiv.addEventListener('click', (e) => {
                    e.stopPropagation(); // Prevent li click
                    openChat(member.id, false); // false for existing/past talk
                });

                li.appendChild(mainClickArea);
                li.appendChild(countDiv);
                memberListUl.appendChild(li);
            });
        }

        function renderChatMessages() {
            chatMessagesContainer.innerHTML = '';
            if (!currentMemberId || !chatHistory[currentMemberId] || chatHistory[currentMemberId].length === 0) {
                chatMessagesContainer.innerHTML = '<p style="text-align:center; color:#aaa; margin-top:20px;">ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</p>';
                return;
            }

            const currentMember = membersData[currentMemberId]; // äº‹å‰ã«å–å¾—

            chatHistory[currentMemberId].forEach((msg, index) => {
                const wrapper = document.createElement('div');
                wrapper.className = `message-bubble-wrapper ${msg.type}`;

                const bubble = document.createElement('div');
                bubble.className = `message-bubble ${msg.type}`;
                bubble.textContent = msg.text;
                bubble.dataset.messageIndex = index;


                if (msg.type === 'ai') {
                    const iconDiv = document.createElement('div');
                    iconDiv.className = 'ai-icon-chat';
                    iconDiv.style.borderColor = currentMember.theme.accentColor; // ç¾åœ¨ã®ãƒ¡ãƒ³ãƒãƒ¼ã®ãƒ†ãƒ¼ãƒã‚«ãƒ©ãƒ¼
                    const aiImg = document.createElement('img');
                    aiImg.src = ICON_PATH + (currentMember.faceIconFile || 'default_face.png');
                    aiImg.alt = currentMember.name;
                    iconDiv.appendChild(aiImg);
                    wrapper.appendChild(iconDiv);

                    const messageContentDiv = document.createElement('div');
                    messageContentDiv.className = 'ai-message-content';
                    const nameSpan = document.createElement('span');
                    nameSpan.className = 'ai-name-chat';
                    nameSpan.textContent = msg.senderName || currentMember.name;
                    messageContentDiv.appendChild(nameSpan);
                    messageContentDiv.appendChild(bubble);
                    wrapper.appendChild(messageContentDiv);

                     // Click for "swipe to regenerate" placeholder
                    bubble.addEventListener('click', () => {
                        alert(`AIãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã€Œ${msg.text}ã€ã‚’å†ç”Ÿæˆã—ã¾ã™ã‹ï¼Ÿ (ã‚¹ãƒ¯ã‚¤ãƒ—æ©Ÿèƒ½ã¯UIãƒ‡ãƒ¢ã®ãŸã‚ã‚¯ãƒªãƒƒã‚¯ã§ä»£æ›¿)`);
                    });

                } else { // user message
                    wrapper.appendChild(bubble);
                    bubble.addEventListener('mousedown', (e) => { // Simulate long press
                        let pressTimer = window.setTimeout(() => {
                            alert(`ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã€Œ${msg.text}ã€ã‚’ç·¨é›†ã—ã¾ã™ã‹ï¼Ÿ\n(ç·¨é›†ã™ã‚‹ã¨ä»¥é™ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒã‚¯ãƒªã‚¢ã•ã‚Œã€AIãŒå†ç”Ÿæˆã—ã¾ã™ - UIãƒ‡ãƒ¢)`);
                        }, 1000); // 1 second for long press
                        const clearTimer = () => clearTimeout(pressTimer);
                        bubble.addEventListener('mouseup', clearTimer, {once: true});
                        bubble.addEventListener('mouseleave', clearTimer, {once: true});
                    });
                }
                chatMessagesContainer.appendChild(wrapper);
            });
            chatMainScrollArea.scrollTop = chatMainScrollArea.scrollHeight; // Scroll to bottom
        }

        function renderMemberSettings() {
            if (!currentMemberId) return;
            const member = membersData[currentMemberId];
            settingsMemberNameH2.textContent = `${member.name} è¨­å®š`;
            settingsMemberIcon.src = ICON_PATH + (member.faceIconFile || 'default_face.png');
            settingsMemberIcon.alt = member.name;
            // ã‚¢ã‚¤ã‚³ãƒ³ã®è¦ªè¦ç´ (ãƒ©ãƒƒãƒ‘ãƒ¼div)ã«æ ç·šè‰²ã‚’è¨­å®š
            if(settingsMemberIconWrapper) settingsMemberIconWrapper.style.borderColor = member.theme.accentColor;


            basicSettingsContainer.innerHTML = '';
            sexualSettingsContainer.innerHTML = '';

            const createSettingItem = (key, value) => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'setting-item';
                const labelSpan = document.createElement('span');
                labelSpan.className = 'label';
                labelSpan.textContent = key;

                const valueDiv = document.createElement('div');

                if (Array.isArray(value)) { // For æ€§æ ¼ etc.
                    valueDiv.className = 'value multi-value';
                    value.forEach(v => {
                        const valSpan = document.createElement('span');
                        valSpan.textContent = v;
                        valueDiv.appendChild(valSpan);
                    });
                } else {
                    valueDiv.className = 'value';
                    valueDiv.textContent = value || 'æœªè¨­å®š'; // Show 'æœªè¨­å®š' for empty strings
                }
                valueDiv.addEventListener('click', () => {
                    const newValue = prompt(`ã€Œ${key}ã€ã®æ–°ã—ã„å€¤ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„:`, Array.isArray(value) ? value.join(', ') : value);
                    if (newValue !== null) {
                        membersData[currentMemberId].settings[key] = Array.isArray(value) ? newValue.split(',').map(s => s.trim()) : newValue;
                        renderMemberSettings(); // Re-render to show changes
                        alert("è¨­å®šãŒæ›´æ–°ã•ã‚Œã¾ã—ãŸï¼ˆå®Ÿéš›ã«ã¯ä¿å­˜å‡¦ç†ãŒå¿…è¦ã§ã™ï¼‰ã€‚ä»–ã®ãƒˆãƒ¼ã‚¯ã«ã‚‚é©ç”¨ã•ã‚Œã¾ã™ã€‚");
                    }
                });


                itemDiv.appendChild(labelSpan);
                itemDiv.appendChild(valueDiv);
                const basicKeys = ['ç”Ÿå¹´æœˆæ—¥', 'ãƒ¡ãƒ³ãƒãƒ¼ã‚«ãƒ©ãƒ¼', 'å‡ºèº«', 'æ–¹è¨€', 'æ€§æ ¼', 'èº«é•·', 'ä½“é‡'];
                (basicKeys.includes(key) ? basicSettingsContainer : sexualSettingsContainer).appendChild(itemDiv);
            };

            for (const [key, value] of Object.entries(member.settings)) {
                createSettingItem(key, value);
            }
        }

        // --- Actions ---
        function openChat(memberId, isNewTalk) {
            currentMemberId = memberId;
            const member = membersData[memberId];
            chatMemberNameH2.textContent = member.name;

            if (isNewTalk) {
                // æ–°ã—ã„ãƒˆãƒ¼ã‚¯ã®å ´åˆã€ã‚‚ã—å±¥æ­´ãŒã‚ã‚Œã°ç¢ºèªã™ã‚‹ï¼ˆä»Šå›ã¯ã‚·ãƒ³ãƒ—ãƒ«ã«æ—¢å­˜å±¥æ­´ã‚’ãã®ã¾ã¾è¡¨ç¤ºï¼‰
            }

            if (!chatHistory[memberId]) {
                chatHistory[memberId] = [
                    { type: 'ai', text: `ã“ã‚“ã«ã¡ã¯ï¼${member.name}ã ã‚ˆã€‚`, senderName: member.name },
                ];
            }
            renderChatMessages();
            showScreen('chat-screen'); // ãƒ†ãƒ¼ãƒé©ç”¨ã¯showScreenå†…ã§è¡Œã†
        }

        function handleSendMessage() {
            const text = messageInput.value.trim();
            if (text === '' || !currentMemberId) return;

            chatHistory[currentMemberId].push({ type: 'user', text: text });
            messageInput.value = '';
            renderChatMessages();

            // Simulate AI reply
            setTimeout(() => {
                const member = membersData[currentMemberId];
                let aiResponse = "ã†ã‚“ã†ã‚“ã€ãã‚Œã§ï¼Ÿ";
                if (text.includes("å¥½ã")) aiResponse = "ç§ã‚‚ã ã‚ˆï¼å¬‰ã—ã„ãªğŸ˜Š";
                else if (text.includes("ä½•ã—ã¦ã‚‹")) aiResponse = "å›ã¨ãŠè©±ã—ã¦ã‚‹ã‚ˆï¼";

                chatHistory[currentMemberId].push({ type: 'ai', text: aiResponse, senderName: member.name });
                renderChatMessages();
            }, 800);
        }

        // --- Event Listeners ---
        navButtons.settings.addEventListener('click', () => showScreen('common-settings-screen'));
        navButtons.talk.addEventListener('click', () => showScreen('talk-list-screen'));
        navButtons.profile.addEventListener('click', () => showScreen('profile-screen'));
        backToTalkListBtns.forEach(btn => btn.addEventListener('click', () => showScreen('talk-list-screen')));


        chatBackToListBtn.addEventListener('click', () => showScreen('talk-list-screen'));
        chatNewTalkBtn.addEventListener('click', () => {
            if (currentMemberId && confirm(`${membersData[currentMemberId].name}ã¨ã®ç¾åœ¨ã®ä¼šè©±ã‚’ã‚¯ãƒªã‚¢ã—ã¦æ–°ã—ã„ãƒˆãƒ¼ã‚¯ã‚’é–‹å§‹ã—ã¾ã™ã‹ï¼Ÿ`)) {
                chatHistory[currentMemberId] = [ { type: 'ai', text: `æ”¹ã‚ã¦ã€ã“ã‚“ã«ã¡ã¯ï¼${membersData[currentMemberId].name}ã ã‚ˆã€‚`, senderName: membersData[currentMemberId].name }];
                renderChatMessages();
                alert("æ–°ã—ã„ãƒˆãƒ¼ã‚¯ã‚’é–‹å§‹ã—ã¾ã—ãŸã€‚");
            }
        });
        chatMenuBtn.addEventListener('click', () => {
            if (currentMemberId) {
                renderMemberSettings();
                showScreen('member-settings-screen');
            }
        });

        sendMessageBtn.addEventListener('click', handleSendMessage);
        messageInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') handleSendMessage();
        });

        replySuggestionsDiv.addEventListener('click', (e) => {
            if (e.target.classList.contains('suggestion-btn')) {
                messageInput.value += (messageInput.value ? ' ' : '') + e.target.textContent;
                messageInput.focus();
            }
        });

        settingsBackToChatBtn.addEventListener('click', () => {
            if (currentMemberId) showScreen('chat-screen');
        });


        // --- Initialization ---
        renderMemberList();
        showScreen('talk-list-screen'); // åˆæœŸç”»é¢è¡¨ç¤º & ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ†ãƒ¼ãƒé©ç”¨
    </script>
</body>
</html>
