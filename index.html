<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>„ÉÅ„É£„ÉÉ„Éà„Çµ„Ç§„Éà</title>
    <style>
        /* --- Âü∫Êú¨„Çπ„Çø„Ç§„É´ --- */
        :root {
            --app-overall-bg: #f0f2f5;
            --talk-list-bg: #ffffff;
            --current-chat-bg: #fdf6e9; /* „Éá„Éï„Ç©„É´„Éà„ÅØ„Éû„Ç≥„Åï„Çì„ÉÜ„Éº„Éû„ÅÆËÉåÊôØ */
            --current-chat-accent: #E67E22; /* „Éá„Éï„Ç©„É´„Éà„ÅØ„Éû„Ç≥„Åï„Çì„ÉÜ„Éº„Éû„ÅÆ„Ç¢„ÇØ„Çª„É≥„Éà */
            --current-user-bubble-bg: #f0dcb3; /* „Éá„Éï„Ç©„É´„Éà„ÅØ„Éû„Ç≥„Åï„Çì„ÉÜ„Éº„Éû„ÅÆ„É¶„Éº„Ç∂„ÉºÂêπ„ÅçÂá∫„Åó */
            --ai-bubble-bg: #ffffff;
            --ai-bubble-border: #e8e8e8;
            --header-text-color: #1c1e21; /* Â∞ë„ÅóÊøÉ„ÅÑ„ÇÅ„ÅÆÈªí */
            --text-color: #333333;
            --border-color: #e0e0e0; /* ÈÄöÂ∏∏„ÅÆÂ¢ÉÁïåÁ∑ö */
            --light-border-color: #f0f0f0; /* ËñÑ„ÅÑÂ¢ÉÁïåÁ∑ö */
            --inactive-text: #888888; /* „Éï„ÉÉ„Çø„ÉºÈùû„Ç¢„ÇØ„ÉÜ„Ç£„ÉñÊôÇ„ÅÆÊñáÂ≠óËâ≤ */
        }
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--app-overall-bg);
            color: var(--text-color);
            display: flex;
            flex-direction: column;
            height: 100dvh; /* ÂãïÁöÑ„Éì„É•„Éº„Éù„Éº„Éà„ÅÆÈ´ò„Åï„Å´Âõ∫ÂÆö */
            overflow: hidden;
        }
        #app {
            display: flex;
            flex-direction: column;
            flex-grow: 1;
            height: 100%; /* Ë¶™(body)„ÅÆÈ´ò„Åï‰∏ÄÊùØ„Å´Â∫É„Åå„Çã */
            overflow: hidden;
        }
        .screen {
            display: none;
            flex-direction: column;
            height: 100%;
            overflow: hidden;
        }
        .screen.active {
            display: flex;
        }
        #talk-list-screen { background-color: var(--talk-list-bg); }
        #chat-screen { background-color: var(--current-chat-bg); }
        #member-settings-screen { background-color: var(--current-chat-bg); }
        #common-settings-screen, #profile-screen { background-color: var(--talk-list-bg); }


        header {
            padding: 8px 12px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            flex-shrink: 0;
            min-height: 48px;
            box-sizing: border-box;
            position: relative;
        }
        #talk-list-screen header {
            background-color: #f7f7f7;
            border-bottom: 1px solid #e7e7e7;
        }
        #talk-list-screen header h1 {
            text-align: left;
            font-size: 1.5em;
            font-weight: bold;
            padding-left: 8px;
            color: var(--header-text-color);
            flex-grow:1;
        }
        #chat-screen header, #member-settings-screen header {
            background-color: var(--current-chat-bg);
            border-bottom-color: transparent;
            min-height: 50px;
        }
        #chat-screen header h2, #member-settings-screen header h2 {
            font-size: 1.1em;
            font-weight: 600;
            color: var(--header-text-color);
            text-align: center;
            flex-grow: 1;
            position: absolute;
            left: 60px;
            right: 60px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }


        header button {
            background: none;
            border: none;
            cursor: pointer;
            padding: 0;
            display:flex;
            align-items:center;
            justify-content:center;
            min-width: 36px;
            min-height:36px;
        }
        header button img {
            height: 22px;
            width:auto;
        }
        #chat-screen header .left-buttons, #member-settings-screen header .left-buttons {
            position: absolute;
            left: 10px;
            top:50%;
            transform: translateY(-50%);
        }
        #chat-screen header .right-buttons {
            position: absolute;
            right: 10px;
            top:50%;
            transform: translateY(-50%);
            display:flex;
            gap: 10px;
        }


        main {
            flex-grow: 1;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }
        #talk-list-screen main,
        #common-settings-screen main,
        #profile-screen main { padding: 0; }

        #chat-screen main { padding: 10px 0 0 0; }
        #member-settings-screen main { padding: 15px; }


        /* „Éï„ÉÉ„Çø„Éº„ÅÆÂÖ±ÈÄö„Çπ„Çø„Ç§„É´ */
        #talk-list-screen > footer,
        #common-settings-screen > footer,
        #profile-screen > footer {
            border-top: 1px solid #dadada;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: space-around;
            flex-shrink: 0;
            background-color: #f7f7f7;
            height: 52px;
            box-sizing: border-box;
        }
        #talk-list-screen footer button,
        #common-settings-screen footer button,
        #profile-screen footer button {
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 0.65em;
            color: var(--inactive-text);
            padding: 4px 0;
            flex: 1;
            display: flex;
            background:none;
            border:none;
            cursor:pointer;
            height: 100%;
        }

        #talk-list-screen footer button img,
        #common-settings-screen footer button img,
        #profile-screen footer button img {
            width: 24px;
            height: 24px;
            margin-bottom: 2px;
        }
        #talk-list-screen footer button span,
        #common-settings-screen footer button span,
        #profile-screen footer button span {
            display:block;
        }

        /* --- Talk List Screen --- */
        #member-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        .member-item {
            display: flex;
            align-items: center;
            padding: 10px 15px;
            border-bottom: 1px solid var(--light-border-color);
            cursor: pointer;
            background-color: var(--talk-list-bg);
        }
        .member-item:active { background-color: #f0f0f0; }
        .member-icon-container {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            margin-right: 12px;
            border-width: 2.5px;
            border-style: solid;
            flex-shrink: 0;
            display:flex;
            align-items:center;
            justify-content:center;
            overflow:hidden;
            background-color: #eee;
        }
        .member-icon-container img {
            width:100%;
            height:100%;
            object-fit:cover;
        }
        .member-name {
            flex-grow: 1;
            font-size: 1.05em;
            font-weight: 500;
            color: #000;
        }
        .member-message-count {
            display: flex;
            align-items: center;
            font-size: 0.9em;
            color: var(--inactive-text);
            padding: 5px 8px;
        }
        .member-message-count img {
            width: 18px;
            height: 18px;
            margin-right: 5px;
        }


        /* --- Chat Screen --- */
        #reply-suggestions-wrapper {
            padding: 8px 10px;
            border-top: 1px solid var(--border-color);
            background-color: var(--current-chat-bg);
            flex-shrink: 0;
            box-shadow: 0 -1px 2px rgba(0,0,0,0.03);
        }
        #reply-suggestions {
            display: flex;
            flex-wrap: nowrap;
            gap: 8px;
            overflow-x: auto;
            padding-bottom: 2px;
        }
        .suggestion-btn {
            background-color: rgba(255,255,255,0.8);
            border: 1px solid #ccc;
            border-radius: 16px;
            padding: 7px 14px;
            font-size: 0.85em;
            cursor: pointer;
            white-space: nowrap;
            color: #333;
            box-shadow: 0 1px 1px rgba(0,0,0,0.05);
        }
        .suggestion-btn:active { background-color: rgba(255,255,255,1); }

        #chat-input-area {
            padding: 8px 10px;
            gap: 8px;
            background-color: #f0f0f0;
            border-top: 1px solid #ccc;
            display: flex;
            align-items: center;
            flex-shrink: 0;
        }
        #message-input {
            flex-grow: 1;
            padding: 10px 15px;
            border-radius: 20px;
            border: 1px solid #d0d0d0;
            font-size: 1em;
            background-color: #fff;
        }
        #message-input:focus {
            outline: none;
            border-color: var(--current-chat-accent);
        }
        #send-message {
            background-color: transparent;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            padding:0;
            flex-shrink: 0;
        }
        #send-message img {
            width: 28px;
            height: 28px;
        }
        #send-message:active img {
            transform: scale(0.95);
        }

        #chat-messages-container {
            display: flex;
            flex-direction: column;
            padding: 0 0 10px 0;
        }
        .message-bubble-wrapper {
            display: flex;
            margin-bottom: 10px;
            padding: 0 10px;
            width: calc(100% - 20px);
            box-sizing: border-box;
        }
        .message-bubble-wrapper.user { justify-content: flex-end; }
        .message-bubble-wrapper.ai { justify-content: flex-start; }

        .ai-icon-chat {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            margin-right: 8px;
            border-width: 2px;
            border-style: solid;
            flex-shrink: 0;
            display:flex;
            align-items:center;
            justify-content:center;
            overflow:hidden;
            background-color: #eee;
        }
        .ai-icon-chat img {
            width:100%;
            height:100%;
            object-fit:cover;
        }
        .ai-message-content {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }
        .ai-name-chat {
            font-size: 0.8em;
            color: #555;
            margin-bottom: 3px;
            padding-left: 2px;
        }
        .message-bubble {
            max-width: 78%;
            padding: 10px 14px;
            border-radius: 18px;
            line-height: 1.45;
            word-wrap: break-word;
            box-shadow: 0 1px 1px rgba(0,0,0,0.08);
        }
        .message-bubble.user {
            background-color: var(--current-user-bubble-bg);
            color: var(--text-color);
            border-bottom-right-radius: 5px;
        }
        .message-bubble.ai {
            background-color: var(--ai-bubble-bg);
            border: 1px solid var(--ai-bubble-border);
            color: var(--text-color);
            border-bottom-left-radius: 5px;
        }


        /* --- Member Settings Screen --- */
        .member-icon-large-container {
            display: flex;
            justify-content: center;
            margin-bottom: 25px;
            padding-top: 10px;
        }
        .member-icon-large {
            width: 90px;
            height: 90px;
            border-radius: 50%;
            border-width: 3.5px;
            border-style: solid;
            display:flex;
            align-items:center;
            justify-content:center;
            overflow:hidden;
            background-color: #eee;
        }
        .member-icon-large img {
            width:100%;
            height:100%;
            object-fit:cover;
        }
        #member-settings-screen h3 {
            font-size: 0.9em;
            color: var(--inactive-text);
            margin-top: 20px;
            margin-bottom: 8px;
            padding-bottom: 6px;
            border-bottom: 1px solid rgba(0,0,0,0.08);
            font-weight: 500;
            padding-left: 5px;
        }
        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 13px 5px;
            font-size: 0.95em;
            border-bottom: 1px solid rgba(0,0,0,0.05);
        }
        .setting-item:last-child { border-bottom: none; }
        .setting-item .label { color: #444; }
        .setting-item .value, .setting-item .value.multi-value span {
            background-color: rgba(255,255,255,0.75);
            border: 1px solid #dcdcdc;
            padding: 6px 12px;
            border-radius: 16px;
            font-size: 0.9em;
            cursor: pointer;
            min-width: 60px;
            text-align: center;
            color: #333;
            box-shadow: 0 1px 1px rgba(0,0,0,0.04);
        }
        .setting-item .value.multi-value {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
            justify-content: flex-end;
            max-width: 65%;
        }
         .setting-item .value.multi-value span { margin-bottom: 4px; }
         .setting-item .value:active { background-color: #fff; }


        /* „Çπ„ÇØ„É≠„Éº„É´„Éê„Éº„ÅÆ„Çπ„Çø„Ç§„É´ */
        main::-webkit-scrollbar, #reply-suggestions::-webkit-scrollbar {
            width: 5px;
            height: 5px;
        }
        main::-webkit-scrollbar-thumb, #reply-suggestions::-webkit-scrollbar-thumb {
            background-color: rgba(0,0,0,0.15);
            border-radius: 3px;
        }
        main::-webkit-scrollbar-track, #reply-suggestions::-webkit-scrollbar-track {
            background-color: transparent;
        }

    </style>
</head>
<body>
    <div id="app">
        <!-- Screen 1: Talk List -->
        <div id="talk-list-screen" class="screen active">
            <header><h1>„Éà„Éº„ÇØ</h1></header>
            <main>
                <ul id="member-list">
                    <!-- Member items will be dynamically generated by JS -->
                </ul>
            </main>
            <footer>
                <button id="nav-common-settings"><img src="image/icon/nav_settings_off.png" alt="ÂÖ±ÈÄöË®≠ÂÆö"><span>ÂÖ±ÈÄöË®≠ÂÆö</span></button>
                <button id="nav-talk" class="active"><img src="image/icon/nav_talk_on.png" alt="„Éà„Éº„ÇØ"><span>„Éà„Éº„ÇØ</span></button>
                <button id="nav-profile"><img src="image/icon/nav_profile_off.png" alt="„Éó„É≠„Éï„Ç£„Éº„É´"><span>„Éó„É≠„Éï„Ç£„Éº„É´</span></button>
            </footer>
        </div>

        <!-- Screen 2: Chat Screen -->
        <div id="chat-screen" class="screen">
            <header>
                <div class="left-buttons"><button id="chat-back-to-list" title="Êàª„Çã"><img src="image/icon/header_back.png" alt="Êàª„Çã"></button></div>
                <h2 id="chat-member-name">„É°„É≥„Éê„ÉºÂêç</h2>
                <div class="right-buttons">
                    <button id="chat-new-talk" title="Êñ∞„Åó„ÅÑ„Éà„Éº„ÇØ„Çí‰ΩúÊàê"><img src="image/icon/header_new_chat.png" alt="Êñ∞„Åó„ÅÑ„Éà„Éº„ÇØ"></button>
                    <button id="chat-menu" title="„É°„É≥„Éê„ÉºË®≠ÂÆö"><img src="image/icon/header_menu.png" alt="„É°„É≥„Éê„ÉºË®≠ÂÆö"></button>
                </div>
            </header>
            <main id="chat-main-scroll-area">
                <div id="chat-messages-container">
                     <!-- Chat messages will be here -->
                </div>
            </main>
            <div id="reply-suggestions-wrapper">
                <div id="reply-suggestions">
                    <button class="suggestion-btn">Ê∞óÊåÅ„Å°„ÅÑ„ÅÑÔºü</button>
                    <button class="suggestion-btn">„Éê„É≥„Éê„É≥„Éê„É≥„Éê„É≥</button>
                    <button class="suggestion-btn">„Éì„É•„É´„É´„É´„É´</button>
                    <button class="suggestion-btn">„ÇÇ„Å£„Å®„Å°„Çá„ÅÜ„Å†„ÅÑ</button>
                    <button class="suggestion-btn">Â§ßÂ•Ω„Åç„Å†„Çà</button>
                </div>
            </div>
            <footer id="chat-input-area">
                <input type="text" id="message-input" placeholder="„É°„ÉÉ„Çª„Éº„Ç∏„ÇíÂÖ•Âäõ...">
                <button id="send-message" title="ÈÄÅ‰ø°"><img src="image/icon/button_send_mako.png" alt="ÈÄÅ‰ø°"></button>
            </footer>
        </div>

        <!-- Screen 3: Member Settings Screen -->
        <div id="member-settings-screen" class="screen">
            <header>
                <div class="left-buttons"><button id="settings-back-to-chat" title="Êàª„Çã"><img src="image/icon/header_back.png" alt="Êàª„Çã"></button></div>
                <h2 id="settings-member-name">„É°„É≥„Éê„ÉºÂêç Ë®≠ÂÆö</h2>
            </header>
            <main>
                <div class="member-icon-large-container">
                    <div class="member-icon-large" id="settings-member-icon-wrapper"><img src="" alt="" id="settings-member-icon"></div>
                </div>
                <h3>Âü∫Êú¨Ë®≠ÂÆö</h3>
                <div id="basic-settings-container">
                    <!-- Basic settings will be dynamically generated -->
                </div>
                <h3>ÊÄßÁöÑË®≠ÂÆö</h3>
                <div id="sexual-settings-container">
                    <!-- Sexual settings will be dynamically generated -->
                </div>
            </main>
        </div>

        <!-- Screen 4: Common Settings -->
        <div id="common-settings-screen" class="screen">
            <header><button class="back-to-talk-list" title="Êàª„Çã"><img src="image/icon/header_back.png" alt="Êàª„Çã"></button><h1>ÂÖ±ÈÄöË®≠ÂÆö</h1></header>
            <main><p style="padding:15px;">ÂÖ±ÈÄöË®≠ÂÆöÁîªÈù¢ (Êú™ÂÆüË£Ö)</p></main>
            <footer>
                <button id="nav-common-settings-cs"><img src="image/icon/nav_settings_off.png" alt="ÂÖ±ÈÄöË®≠ÂÆö"><span>ÂÖ±ÈÄöË®≠ÂÆö</span></button>
                <button id="nav-talk-cs"><img src="image/icon/nav_talk_off.png" alt="„Éà„Éº„ÇØ"><span>„Éà„Éº„ÇØ</span></button>
                <button id="nav-profile-cs"><img src="image/icon/nav_profile_off.png" alt="„Éó„É≠„Éï„Ç£„Éº„É´"><span>„Éó„É≠„Éï„Ç£„Éº„É´</span></button>
            </footer>
        </div>

        <!-- Screen 5: Profile Screen -->
        <div id="profile-screen" class="screen">
            <header><button class="back-to-talk-list" title="Êàª„Çã"><img src="image/icon/header_back.png" alt="Êàª„Çã"></button><h1>„Éó„É≠„Éï„Ç£„Éº„É´</h1></header>
            <main><p style="padding:15px;">„Éó„É≠„Éï„Ç£„Éº„É´ÁîªÈù¢ (Êú™ÂÆüË£Ö)</p></main>
            <footer>
                <button id="nav-common-settings-p"><img src="image/icon/nav_settings_off.png" alt="ÂÖ±ÈÄöË®≠ÂÆö"><span>ÂÖ±ÈÄöË®≠ÂÆö</span></button>
                <button id="nav-talk-p"><img src="image/icon/nav_talk_off.png" alt="„Éà„Éº„ÇØ"><span>„Éà„Éº„ÇØ</span></button>
                <button id="nav-profile-p"><img src="image/icon/nav_profile_off.png" alt="„Éó„É≠„Éï„Ç£„Éº„É´"><span>„Éó„É≠„Éï„Ç£„Éº„É´</span></button>
            </footer>
        </div>
    </div>

    <script>
        const ICON_PATH = 'image/icon/';

        const membersThemeData = {
            'mako':  { name: '„Éû„Ç≥', accentColor: '#E67E22', bgColor: '#fdf6e9', userBubbleBg: '#f0dcb3' },
            'rio':   { name: '„É™„Ç™', accentColor: '#3498DB', bgColor: '#eaf3f9', userBubbleBg: '#cce0f1' },
            'maya':  { name: '„Éû„É§', accentColor: '#8E44AD', bgColor: '#f4eef7', userBubbleBg: '#e2d2ea' },
            'riku':  { name: '„É™„ÇØ', accentColor: '#F1C40F', bgColor: '#fef9e7', userBubbleBg: '#fbeea9' },
            'ayaka': { name: '„Ç¢„É§„Ç´', accentColor: '#AAB8C2', bgColor: '#f5f7f8', userBubbleBg: '#dde3e6' },
            'mayuka':{ name: '„Éû„É¶„Ç´', accentColor: '#1ABC9C', bgColor: '#e8f8f5', userBubbleBg: '#c5e9e0' },
            'rima':  { name: '„É™„Éû', accentColor: '#E74C3C', bgColor: '#fdedeb', userBubbleBg: '#f6cec8' },
            'miihi': { name: '„Éü„Ç§„Éí', accentColor: '#FF69B4', bgColor: '#fff0f7', userBubbleBg: '#ffd9ec' },
            'nina':  { name: '„Éã„Éä', accentColor: '#34495E', bgColor: '#ebedef', userBubbleBg: '#ccd1d6' }
        };

        let membersData = {
            'mako': { id: 'mako', name: '„Éû„Ç≥', msgCount: 9, theme: membersThemeData['mako'], faceIconFile: 'mako_face.png', sendButtonIconFile: 'button_send_mako.png', settings: { 'ÁîüÂπ¥ÊúàÊó•': '2001Âπ¥4Êúà4Êó•', '„É°„É≥„Éê„Éº„Ç´„É©„Éº': '„Ç™„É¨„É≥„Ç∏', 'Âá∫Ë∫´': 'Á¶èÂ≤°', 'ÊñπË®Ä': 'ËªΩ„ÅÑÂçöÂ§öÂºÅ', 'ÊÄßÊ†º': ['Â§©ÁÑ∂', '„Åó„Å£„Åã„ÇäËÄÖ'], 'Ë∫´Èï∑': '159cm', '‰ΩìÈáç': '49kg', 'ËÉ∏„ÅÆ„Çµ„Ç§„Ç∫': 'C„Ç´„ÉÉ„Éó', '‰π≥È¶ñ„ÅÆËâ≤': 'ËñÑ„ÅÑËå∂Ëâ≤', 'Èô∞ÊØõ': 'Â∞ë„ÅóÁîü„Åà„Å¶„ÅÑ„Çã', '„Åæ„Çì„Åì„ÅÆËâ≤': '„Éî„É≥„ÇØ', 'ÊÄßÊ¨≤': 'ÊôÆÈÄö', 'Â•Ω„Åç„Å™‰Ωì‰Ωç': 'Ê≠£Â∏∏‰Ωç', 'ÊÑüÂ∫¶': '„Åô„Åê„Ç§„ÉÉ„Å°„ÇÉ„ÅÜ', 'ÂæóÊÑè„Å™ÂâçÊàØ': '„Éï„Çß„É©' } },
            'rio':  { id: 'rio',  name: '„É™„Ç™', msgCount: 10, theme: membersThemeData['rio'], faceIconFile: 'rio_face.png', sendButtonIconFile: 'button_send_rio.png', settings: { 'ÁîüÂπ¥ÊúàÊó•': '2002Âπ¥2Êúà4Êó•', '„É°„É≥„Éê„Éº„Ç´„É©„Éº': '„Éñ„É´„Éº', 'Âá∫Ë∫´': 'ÊÑõÁü•','ÊÄßÊ†º': ['Âä™ÂäõÂÆ∂'], 'ËÉ∏„ÅÆ„Çµ„Ç§„Ç∫': 'B„Ç´„ÉÉ„Éó' } },
            'maya': { id: 'maya', name: '„Éû„É§', msgCount: 7, theme: membersThemeData['maya'], faceIconFile: 'maya_face.png', sendButtonIconFile: 'button_send_maya.png', settings: { 'ÁîüÂπ¥ÊúàÊó•': '2002Âπ¥4Êúà8Êó•', '„É°„É≥„Éê„Éº„Ç´„É©„Éº': '„Éë„Éº„Éó„É´','Âá∫Ë∫´': 'Áü≥Â∑ù', 'ÊÄßÊ†º': ['„Åä„Å£„Å®„Çä'], 'ËÉ∏„ÅÆ„Çµ„Ç§„Ç∫': 'D„Ç´„ÉÉ„Éó' } },
            'riku': { id: 'riku', name: '„É™„ÇØ', msgCount: 0, theme: membersThemeData['riku'], faceIconFile: 'riku_face.png', sendButtonIconFile: 'button_send_riku.png', settings: { 'ÁîüÂπ¥ÊúàÊó•': '2002Âπ¥10Êúà26Êó•', '„É°„É≥„Éê„Éº„Ç´„É©„Éº': '„Ç§„Ç®„É≠„Éº','Âá∫Ë∫´': '‰∫¨ÈÉΩ',  'ÊÄßÊ†º': ['ÂÖÉÊ∞ó'], 'ËÉ∏„ÅÆ„Çµ„Ç§„Ç∫': 'A„Ç´„ÉÉ„Éó' } },
            'ayaka':{ id: 'ayaka',name: '„Ç¢„É§„Ç´', msgCount: 1, theme: membersThemeData['ayaka'],faceIconFile: 'ayaka_face.png',sendButtonIconFile: 'button_send_ayaka.png',settings: { 'ÁîüÂπ¥ÊúàÊó•': '2003Âπ¥6Êúà20Êó•', '„É°„É≥„Éê„Éº„Ç´„É©„Éº': '„Éõ„ÉØ„Ç§„Éà','Âá∫Ë∫´': 'Êù±‰∫¨', 'ÊÄßÊ†º': ['„Éû„Ç§„Éö„Éº„Çπ'], 'ËÉ∏„ÅÆ„Çµ„Ç§„Ç∫': 'C„Ç´„ÉÉ„Éó' } },
            'mayuka':{id: 'mayuka',name: '„Éû„É¶„Ç´',msgCount: 12,theme: membersThemeData['mayuka'],faceIconFile: 'mayuka_face.png',sendButtonIconFile: 'button_send_mayuka.png',settings: { 'ÁîüÂπ¥ÊúàÊó•': '2003Âπ¥11Êúà13Êó•', '„É°„É≥„Éê„Éº„Ç´„É©„Éº': '„É©„Ç§„Éà„Ç∞„É™„Éº„É≥','Âá∫Ë∫´': '‰∫¨ÈÉΩ', 'ÊÄßÊ†º': ['„Ç´„É°„É¨„Ç™„É≥'], 'ËÉ∏„ÅÆ„Çµ„Ç§„Ç∫': 'B„Ç´„ÉÉ„Éó' } },
            'rima': { id: 'rima', name: '„É™„Éû', msgCount: 15, theme: membersThemeData['rima'], faceIconFile: 'rima_face.png', sendButtonIconFile: 'button_send_rima.png', settings: { 'ÁîüÂπ¥ÊúàÊó•': '2004Âπ¥3Êúà26Êó•', '„É°„É≥„Éê„Éº„Ç´„É©„Éº': '„É¨„ÉÉ„Éâ','Âá∫Ë∫´': 'Êù±‰∫¨', 'ÊÄßÊ†º': ['„Åä„Åó„ÇÉ„Çå'], 'ËÉ∏„ÅÆ„Çµ„Ç§„Ç∫': 'C„Ç´„ÉÉ„Éó' } },
            'miihi':{ id: 'miihi',name: '„Éü„Ç§„Éí',msgCount: 17,theme: membersThemeData['miihi'],faceIconFile: 'miihi_face.png',sendButtonIconFile: 'button_send_miihi.png',settings: { 'ÁîüÂπ¥ÊúàÊó•': '2004Âπ¥8Êúà12Êó•', '„É°„É≥„Éê„Éº„Ç´„É©„Éº': '„Éî„É≥„ÇØ','Âá∫Ë∫´': '‰∫¨ÈÉΩ', 'ÊÄßÊ†º': ['Áôí„Åó'], 'ËÉ∏„ÅÆ„Çµ„Ç§„Ç∫': 'A„Ç´„ÉÉ„Éó' } },
            'nina': { id: 'nina', name: '„Éã„Éä', msgCount: 2, theme: membersThemeData['nina'], faceIconFile: 'nina_face.png', sendButtonIconFile: 'button_send_nina.png', settings: { 'ÁîüÂπ¥ÊúàÊó•': '2005Âπ¥2Êúà27Êó•', '„É°„É≥„Éê„Éº„Ç´„É©„Éº': '„Éç„Ç§„Éì„Éº','Âá∫Ë∫´': '„ÉØ„Ç∑„É≥„Éà„É≥Â∑û', 'ÊÄßÊ†º': ['Êú´„Å£Â≠ê'], 'ËÉ∏„ÅÆ„Çµ„Ç§„Ç∫': 'D„Ç´„ÉÉ„Éó' } },
        };
        Object.values(membersData).forEach(member => {
            const defaultSettings = { 'ÁîüÂπ¥ÊúàÊó•': '', '„É°„É≥„Éê„Éº„Ç´„É©„Éº': '', 'Âá∫Ë∫´': '', 'ÊñπË®Ä': '', 'ÊÄßÊ†º': [], 'Ë∫´Èï∑': '', '‰ΩìÈáç': '', 'ËÉ∏„ÅÆ„Çµ„Ç§„Ç∫': '', '‰π≥È¶ñ„ÅÆËâ≤': '', 'Èô∞ÊØõ': '', '„Åæ„Çì„Åì„ÅÆËâ≤': '', 'ÊÄßÊ¨≤': '', 'Â•Ω„Åç„Å™‰Ωì‰Ωç': '', 'ÊÑüÂ∫¶': '', 'ÂæóÊÑè„Å™ÂâçÊàØ': '' };
            member.settings = { ...defaultSettings, ...member.settings };
            if (!member.faceIconFile) member.faceIconFile = 'default_face.png';
        });

        let currentMemberId = null;
        let chatHistory = {};

        const screens = document.querySelectorAll('.screen');
        const memberListUl = document.getElementById('member-list');

        const navCommonSettingsBtn = document.getElementById('nav-common-settings');
        const navTalkBtn = document.getElementById('nav-talk');
        const navProfileBtn = document.getElementById('nav-profile');
        const navCommonSettingsCsBtn = document.getElementById('nav-common-settings-cs');
        const navTalkCsBtn = document.getElementById('nav-talk-cs');
        const navProfileCsBtn = document.getElementById('nav-profile-cs');
        const navCommonSettingsPBtn = document.getElementById('nav-common-settings-p');
        const navTalkPBtn = document.getElementById('nav-talk-p');
        const navProfilePBtn = document.getElementById('nav-profile-p');


        const chatMainScrollArea = document.getElementById('chat-main-scroll-area');
        const chatBackToListBtn = document.getElementById('chat-back-to-list');
        const chatMemberNameH2 = document.getElementById('chat-member-name');
        const chatNewTalkBtn = document.getElementById('chat-new-talk');
        const chatMenuBtn = document.getElementById('chat-menu');
        const chatMessagesContainer = document.getElementById('chat-messages-container');
        const replySuggestionsDiv = document.getElementById('reply-suggestions');
        const messageInput = document.getElementById('message-input');
        const sendMessageBtn = document.getElementById('send-message');
        const sendMessageImg = sendMessageBtn.querySelector('img');

        const settingsBackToChatBtn = document.getElementById('settings-back-to-chat');
        const settingsMemberNameH2 = document.getElementById('settings-member-name');
        const settingsMemberIcon = document.getElementById('settings-member-icon');
        const settingsMemberIconWrapper = document.getElementById('settings-member-icon-wrapper');
        const basicSettingsContainer = document.getElementById('basic-settings-container');
        const sexualSettingsContainer = document.getElementById('sexual-settings-container');

        const rootStyle = document.documentElement.style;

        function applyTheme(memberId) {
            const member = membersData[memberId];
            if (member && member.theme) {
                rootStyle.setProperty('--current-chat-bg', member.theme.bgColor);
                rootStyle.setProperty('--current-chat-accent', member.theme.accentColor);
                rootStyle.setProperty('--current-user-bubble-bg', member.theme.userBubbleBg);
                if (sendMessageImg && member.sendButtonIconFile) {
                    sendMessageImg.src = ICON_PATH + member.sendButtonIconFile;
                    sendMessageImg.alt = `${member.name}„Å∏ÈÄÅ‰ø°`;
                }
            }
        }
        function resetThemeToDefault() {
            rootStyle.setProperty('--current-chat-bg', membersThemeData['mako'].bgColor);
            rootStyle.setProperty('--current-chat-accent', membersThemeData['mako'].accentColor);
            rootStyle.setProperty('--current-user-bubble-bg', membersThemeData['mako'].userBubbleBg);
            if (sendMessageImg && membersData['mako']?.sendButtonIconFile) {
                 sendMessageImg.src = ICON_PATH + membersData['mako'].sendButtonIconFile;
                 sendMessageImg.alt = `ÈÄÅ‰ø°`;
            }
        }

        function updateFooterNavIcons(activeScreenId) {
            const allNavButtons = [
                { btn: navCommonSettingsBtn, screen: 'common-settings-screen', baseName: 'nav_settings' },
                { btn: navTalkBtn, screen: 'talk-list-screen', baseName: 'nav_talk' },
                { btn: navProfileBtn, screen: 'profile-screen', baseName: 'nav_profile' },
                { btn: navCommonSettingsCsBtn, screen: 'common-settings-screen', baseName: 'nav_settings' },
                { btn: navTalkCsBtn, screen: 'talk-list-screen', baseName: 'nav_talk' },
                { btn: navProfileCsBtn, screen: 'profile-screen', baseName: 'nav_profile' },
                { btn: navCommonSettingsPBtn, screen: 'common-settings-screen', baseName: 'nav_settings' },
                { btn: navTalkPBtn, screen: 'talk-list-screen', baseName: 'nav_talk' },
                { btn: navProfilePBtn, screen: 'profile-screen', baseName: 'nav_profile' },
            ];

            allNavButtons.forEach(item => {
                if (!item.btn) return;
                const img = item.btn.querySelector('img');
                const span = item.btn.querySelector('span');
                if (!img || !span) return;

                if (item.screen === activeScreenId) {
                    img.src = ICON_PATH + item.baseName + '_on.png';
                    span.style.color = '#000000';
                } else {
                    img.src = ICON_PATH + item.baseName + '_off.png';
                    span.style.color = '';
                }
            });
        }


        function showScreen(screenId) {
            screens.forEach(screen => screen.classList.remove('active'));
            document.getElementById(screenId).classList.add('active');
            updateFooterNavIcons(screenId);

            if (screenId === 'chat-screen' || screenId === 'member-settings-screen') {
                if (currentMemberId) applyTheme(currentMemberId);
            } else {
                resetThemeToDefault();
            }
        }

        function renderMemberList() {
            memberListUl.innerHTML = '';
            Object.values(membersData).forEach(member => {
                const li = document.createElement('li');
                li.className = 'member-item';
                li.dataset.memberId = member.id;
                const iconContainer = document.createElement('div');
                iconContainer.className = 'member-icon-container';
                iconContainer.style.borderColor = member.theme.accentColor;
                const iconImg = document.createElement('img');
                iconImg.src = ICON_PATH + (member.faceIconFile || 'default_face.png');
                iconImg.alt = member.name;
                iconContainer.appendChild(iconImg);
                const nameSpan = document.createElement('span');
                nameSpan.className = 'member-name';
                nameSpan.textContent = member.name;
                const countDiv = document.createElement('div');
                countDiv.className = 'member-message-count';
                const countIcon = document.createElement('img');
                countIcon.src = ICON_PATH + 'icon_message_bubble.png';
                countIcon.alt = '„É°„ÉÉ„Çª„Éº„Ç∏';
                countDiv.appendChild(countIcon);
                countDiv.append(` ${member.msgCount}`);
                const mainClickArea = document.createElement('div');
                mainClickArea.style.cssText = 'display:flex; align-items:center; flex-grow:1; cursor:pointer;';
                mainClickArea.appendChild(iconContainer);
                mainClickArea.appendChild(nameSpan);
                mainClickArea.addEventListener('click', () => openChat(member.id, true));
                countDiv.style.cursor = 'pointer';
                countDiv.addEventListener('click', (e) => { e.stopPropagation(); openChat(member.id, false); });
                li.appendChild(mainClickArea);
                li.appendChild(countDiv);
                memberListUl.appendChild(li);
            });
        }

        function renderChatMessages() {
            chatMessagesContainer.innerHTML = '';
            if (!currentMemberId || !chatHistory[currentMemberId] || chatHistory[currentMemberId].length === 0) {
                chatMessagesContainer.innerHTML = '<p style="text-align:center; color:#aaa; margin-top:20px;">„É°„ÉÉ„Çª„Éº„Ç∏„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ</p>';
                return;
            }
            const currentMember = membersData[currentMemberId];
            chatHistory[currentMemberId].forEach((msg, index) => {
                const wrapper = document.createElement('div');
                wrapper.className = `message-bubble-wrapper ${msg.type}`;
                const bubble = document.createElement('div');
                bubble.className = `message-bubble ${msg.type}`;
                bubble.textContent = msg.text;
                bubble.dataset.messageIndex = index;
                if (msg.type === 'ai') {
                    const iconDiv = document.createElement('div');
                    iconDiv.className = 'ai-icon-chat';
                    iconDiv.style.borderColor = currentMember.theme.accentColor;
                    const aiImg = document.createElement('img');
                    aiImg.src = ICON_PATH + (currentMember.faceIconFile || 'default_face.png');
                    aiImg.alt = currentMember.name;
                    iconDiv.appendChild(aiImg);
                    wrapper.appendChild(iconDiv);
                    const messageContentDiv = document.createElement('div');
                    messageContentDiv.className = 'ai-message-content';
                    const nameSpan = document.createElement('span');
                    nameSpan.className = 'ai-name-chat';
                    nameSpan.textContent = msg.senderName || currentMember.name;
                    messageContentDiv.appendChild(nameSpan);
                    messageContentDiv.appendChild(bubble);
                    wrapper.appendChild(messageContentDiv);
                    bubble.addEventListener('click', () => {
                        alert(`AI„É°„ÉÉ„Çª„Éº„Ç∏„Äå${msg.text}„Äç„ÇíÂÜçÁîüÊàê„Åó„Åæ„Åô„ÅãÔºü (UI„Éá„É¢)`);
                    });
                } else {
                    wrapper.appendChild(bubble);
                    bubble.addEventListener('mousedown', (e) => {
                        let pressTimer = window.setTimeout(() => {
                            alert(`„É°„ÉÉ„Çª„Éº„Ç∏„Äå${msg.text}„Äç„ÇíÁ∑®ÈõÜ„Åó„Åæ„Åô„ÅãÔºü (UI„Éá„É¢)`);
                        }, 1000);
                        const clearTimer = () => clearTimeout(pressTimer);
                        bubble.addEventListener('mouseup', clearTimer, {once: true});
                        bubble.addEventListener('mouseleave', clearTimer, {once: true});
                    });
                }
                chatMessagesContainer.appendChild(wrapper);
            });
            chatMainScrollArea.scrollTop = chatMainScrollArea.scrollHeight;
        }

        function renderMemberSettings() {
            if (!currentMemberId) return;
            const member = membersData[currentMemberId];
            settingsMemberNameH2.textContent = `${member.name} Ë®≠ÂÆö`;
            settingsMemberIcon.src = ICON_PATH + (member.faceIconFile || 'default_face.png');
            settingsMemberIcon.alt = member.name;
            if(settingsMemberIconWrapper) settingsMemberIconWrapper.style.borderColor = member.theme.accentColor;
            basicSettingsContainer.innerHTML = '';
            sexualSettingsContainer.innerHTML = '';
            const createSettingItem = (key, value) => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'setting-item';
                const labelSpan = document.createElement('span');
                labelSpan.className = 'label';
                labelSpan.textContent = key;
                const valueDiv = document.createElement('div');
                if (Array.isArray(value)) {
                    valueDiv.className = 'value multi-value';
                    value.forEach(v => { const valSpan = document.createElement('span'); valSpan.textContent = v; valueDiv.appendChild(valSpan); });
                } else {
                    valueDiv.className = 'value'; valueDiv.textContent = value || 'Êú™Ë®≠ÂÆö';
                }
                valueDiv.addEventListener('click', () => {
                    const newValue = prompt(`„Äå${key}„Äç„ÅÆÊñ∞„Åó„ÅÑÂÄ§„ÇíÂÖ•Âäõ:`, Array.isArray(value) ? value.join(', ') : value);
                    if (newValue !== null) {
                        membersData[currentMemberId].settings[key] = Array.isArray(value) ? newValue.split(',').map(s => s.trim()) : newValue;
                        renderMemberSettings(); alert("Ë®≠ÂÆö„ÅåÊõ¥Êñ∞„Åï„Çå„Åæ„Åó„ÅüÔºà‰øùÂ≠òÂá¶ÁêÜ„ÅØÊú™ÂÆüË£ÖÔºâ„ÄÇ");
                    }
                });
                itemDiv.appendChild(labelSpan); itemDiv.appendChild(valueDiv);
                const basicKeys = ['ÁîüÂπ¥ÊúàÊó•', '„É°„É≥„Éê„Éº„Ç´„É©„Éº', 'Âá∫Ë∫´', 'ÊñπË®Ä', 'ÊÄßÊ†º', 'Ë∫´Èï∑', '‰ΩìÈáç'];
                (basicKeys.includes(key) ? basicSettingsContainer : sexualSettingsContainer).appendChild(itemDiv);
            };
            for (const [key, value] of Object.entries(member.settings)) { createSettingItem(key, value); }
        }

        function openChat(memberId, isNewTalk) {
            currentMemberId = memberId;
            const member = membersData[memberId];
            chatMemberNameH2.textContent = member.name;
            if (!chatHistory[memberId]) {
                chatHistory[memberId] = [{ type: 'ai', text: `„Åì„Çì„Å´„Å°„ÅØÔºÅ${member.name}„Å†„Çà„ÄÇ`, senderName: member.name }];
            }
            renderChatMessages();
            showScreen('chat-screen');
        }

        function handleSendMessage() {
            const text = messageInput.value.trim();
            if (text === '' || !currentMemberId) return;
            chatHistory[currentMemberId].push({ type: 'user', text: text });
            messageInput.value = '';
            renderChatMessages();
            setTimeout(() => {
                const member = membersData[currentMemberId];
                let aiResponse = "„ÅÜ„Çì„ÄÅ„Åù„Çå„ÅßÔºü";
                if (text.includes("Â•Ω„Åç")) aiResponse = "ÁßÅ„ÇÇ„Å†„ÇàÔºÅÂ¨â„Åó„ÅÑ„Å™üòä";
                chatHistory[currentMemberId].push({ type: 'ai', text: aiResponse, senderName: member.name });
                renderChatMessages();
            }, 800);
        }

        // Event Listeners
        if(navCommonSettingsBtn) navCommonSettingsBtn.addEventListener('click', () => showScreen('common-settings-screen'));
        if(navTalkBtn) navTalkBtn.addEventListener('click', () => showScreen('talk-list-screen'));
        if(navProfileBtn) navProfileBtn.addEventListener('click', () => showScreen('profile-screen'));
        if(navCommonSettingsCsBtn) navCommonSettingsCsBtn.addEventListener('click', () => showScreen('common-settings-screen'));
        if(navTalkCsBtn) navTalkCsBtn.addEventListener('click', () => showScreen('talk-list-screen'));
        if(navProfileCsBtn) navProfileCsBtn.addEventListener('click', () => showScreen('profile-screen'));
        if(navCommonSettingsPBtn) navCommonSettingsPBtn.addEventListener('click', () => showScreen('common-settings-screen'));
        if(navTalkPBtn) navTalkPBtn.addEventListener('click', () => showScreen('talk-list-screen'));
        if(navProfilePBtn) navProfilePBtn.addEventListener('click', () => showScreen('profile-screen'));


        document.querySelectorAll('.back-to-talk-list').forEach(btn => btn.addEventListener('click', () => showScreen('talk-list-screen')));
        chatBackToListBtn.addEventListener('click', () => showScreen('talk-list-screen'));
        chatNewTalkBtn.addEventListener('click', () => {
            if (currentMemberId && confirm(`${membersData[currentMemberId].name}„Å®„ÅÆ‰ºöË©±„Çí„ÇØ„É™„Ç¢„Åó„Åæ„Åô„ÅãÔºü`)) {
                chatHistory[currentMemberId] = [{ type: 'ai', text: `Êîπ„ÇÅ„Å¶„ÄÅ„Åì„Çì„Å´„Å°„ÅØÔºÅ${membersData[currentMemberId].name}„Å†„Çà„ÄÇ`, senderName: membersData[currentMemberId].name }];
                renderChatMessages();
            }
        });
        chatMenuBtn.addEventListener('click', () => { if (currentMemberId) { renderMemberSettings(); showScreen('member-settings-screen'); }});
        sendMessageBtn.addEventListener('click', handleSendMessage);
        messageInput.addEventListener('keypress', (e) => { if (e.key === 'Enter') handleSendMessage(); });
        replySuggestionsDiv.addEventListener('click', (e) => {
            if (e.target.classList.contains('suggestion-btn')) {
                messageInput.value += (messageInput.value ? ' ' : '') + e.target.textContent; messageInput.focus();
            }
        });
        settingsBackToChatBtn.addEventListener('click', () => { if (currentMemberId) showScreen('chat-screen'); });

        renderMemberList();
        showScreen('talk-list-screen');
    </script>
</body>
</html>
